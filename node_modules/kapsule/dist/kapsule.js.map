{"version":3,"file":"kapsule.js","sources":["../node_modules/debounce/index.js","../src/index.js"],"sourcesContent":["/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear' \n * that is a function which will clear the timer to prevent previously scheduled executions. \n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, wait, immediate){\n  var timeout, args, context, timestamp, result;\n  if (null == wait) wait = 100;\n\n  function later() {\n    var last = Date.now() - timestamp;\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last);\n    } else {\n      timeout = null;\n      if (!immediate) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n    }\n  };\n\n  var debounced = function(){\n    context = this;\n    args = arguments;\n    timestamp = Date.now();\n    var callNow = immediate && !timeout;\n    if (!timeout) timeout = setTimeout(later, wait);\n    if (callNow) {\n      result = func.apply(context, args);\n      context = args = null;\n    }\n\n    return result;\n  };\n\n  debounced.clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n  \n  debounced.flush = function() {\n    if (timeout) {\n      result = func.apply(context, args);\n      context = args = null;\n      \n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n\n  return debounced;\n};\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nmodule.exports = debounce;\n","import debounce from 'debounce';\n\nclass Prop {\n  constructor(name, {\n    default: defaultVal = null,\n    triggerUpdate = true,\n    onChange = (newVal, state) => {}\n  }) {\n    this.name = name;\n    this.defaultVal = defaultVal;\n    this.triggerUpdate = triggerUpdate;\n    this.onChange = onChange;\n  }\n}\n\nexport default function ({\n  stateInit = (() => ({})),\n  props: rawProps = {},\n  methods = {},\n  aliases = {},\n  init: initFn = (() => {}),\n  update: updateFn = (() => {})\n}) {\n\n  // Parse props into Prop instances\n  const props = Object.keys(rawProps).map(propName =>\n    new Prop(propName, rawProps[propName])\n  );\n\n  return function(options = {}) {\n\n    // Holds component state\n    let state = Object.assign({},\n      stateInit instanceof Function ? stateInit(options) : stateInit, // Support plain objects for backwards compatibility\n      { initialised: false }\n    );\n\n    // keeps track of which props triggered an update\n    let changedProps = {};\n\n    // Component constructor\n    function comp(nodeElement) {\n      initStatic(nodeElement, options);\n      digest();\n\n      return comp;\n    }\n\n    const initStatic = function(nodeElement, options) {\n      initFn.call(comp, nodeElement, state, options);\n      state.initialised = true;\n    };\n\n    const digest = debounce(() => {\n      if (!state.initialised) { return; }\n      updateFn.call(comp, state, changedProps);\n      changedProps = {};\n    }, 1);\n\n    // Getter/setter methods\n    props.forEach(prop => {\n      comp[prop.name] = getSetProp(prop);\n\n      function getSetProp({\n        name: prop,\n        triggerUpdate: redigest = false,\n        onChange = (newVal, state) => {},\n        defaultVal = null\n      }) {\n        return function(_) {\n          const curVal = state[prop];\n          if (!arguments.length) { return curVal } // Getter mode\n\n          const val = _ === undefined ? defaultVal : _; // pick default if value passed is undefined\n          state[prop] = val;\n          onChange.call(comp, val, state, curVal);\n\n          // track changed props\n          !changedProps.hasOwnProperty(prop) && (changedProps[prop] = curVal);\n\n          if (redigest) { digest(); }\n          return comp;\n        }\n      }\n    });\n\n    // Other methods\n    Object.keys(methods).forEach(methodName => {\n      comp[methodName] = (...args) => methods[methodName].call(comp, state, ...args);\n    });\n\n    // Link aliases\n    Object.entries(aliases).forEach(([alias, target]) => comp[alias] = comp[target]);\n\n    // Reset all component props to their default value\n    comp.resetProps = function() {\n      props.forEach(prop => {\n        comp[prop.name](prop.defaultVal);\n      });\n      return comp;\n    };\n\n    //\n\n    comp.resetProps(); // Apply all prop defaults\n    state._rerender = digest; // Expose digest method\n\n    return comp;\n  }\n}\n"],"names":["Prop","name","defaultVal","triggerUpdate","onChange","newVal","state","stateInit","props","rawProps","methods","aliases","init","initFn","update","updateFn","Object","keys","map","propName","options","assign","Function","initialised","changedProps","comp","nodeElement","initStatic","digest","call","debounce","forEach","prop","getSetProp","redigest","_","curVal","arguments","length","val","undefined","hasOwnProperty","methodName","args","entries","alias","target","resetProps","_rerender"],"mappings":"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"}