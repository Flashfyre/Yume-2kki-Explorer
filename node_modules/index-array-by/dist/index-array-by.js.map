{"version":3,"file":"index-array-by.js","sources":["../src/index.js"],"sourcesContent":["export default (list = [], keyAccessors = [], multiItem = true, flattenKeys = false) => {\n\n  const keys = (keyAccessors instanceof Array\n    ? (keyAccessors.length ? keyAccessors : [undefined])\n    : [keyAccessors]).map(key => ({\n    keyAccessor: key,\n    isProp: !(key instanceof Function)\n  }));\n\n  const indexedResult = list.reduce((res, item) => {\n    let iterObj = res;\n    let itemVal = item;\n\n    keys.forEach(({ keyAccessor, isProp }, idx) => {\n      let key;\n      if (isProp) {\n        const { [keyAccessor]: propVal, ...rest } = itemVal;\n        key = propVal;\n        itemVal = rest;\n      } else {\n        key = keyAccessor(itemVal, idx);\n      }\n\n      if (idx + 1 < keys.length) {\n        if (!iterObj.hasOwnProperty(key)) {\n          iterObj[key] = {};\n        }\n        iterObj = iterObj[key];\n      } else { // Leaf key\n        if (multiItem) {\n          if (!iterObj.hasOwnProperty(key)) {\n            iterObj[key] = [];\n          }\n          iterObj[key].push(itemVal);\n        } else {\n          iterObj[key] = itemVal;\n        }\n      }\n    });\n    return res;\n  }, {});\n\n  if (multiItem  instanceof Function) {\n    // Reduce leaf multiple values\n    (function reduce(node, level = 1) {\n      if (level === keys.length) {\n        Object.keys(node).forEach(k => node[k] = multiItem(node[k]));\n      } else {\n        Object.values(node).forEach(child => reduce(child, level + 1));\n      }\n    })(indexedResult); // IIFE\n  }\n\n  let result = indexedResult;\n\n  if (flattenKeys) {\n    // flatten into array\n    result = [];\n\n    (function flatten(node, accKeys = []) {\n      if (accKeys.length === keys.length) {\n        result.push({\n          keys: accKeys,\n          vals: node\n        });\n      } else {\n        Object.entries(node)\n          .forEach(([key, val]) => flatten(val, [...accKeys, key]));\n      }\n    })(indexedResult); //IIFE\n\n    if (keyAccessors instanceof Array && keyAccessors.length === 0 && result.length === 1) {\n      // clear keys if there's no key accessors (single result)\n      result[0].keys = [];\n    }\n  }\n\n  return result;\n}\n"],"names":["list","keyAccessors","multiItem","flattenKeys","keys","Array","length","undefined","map","key","keyAccessor","isProp","Function","indexedResult","reduce","res","item","iterObj","itemVal","forEach","idx","propVal","rest","hasOwnProperty","push","node","level","Object","k","values","child","result","flatten","accKeys","vals","entries","val"],"mappings":"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"}